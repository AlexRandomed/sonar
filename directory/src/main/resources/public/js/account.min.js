routes.define(function(a){a.when("/edit-user/:id",{action:"editUser"}).when("/edit-user-infos/:id",{action:"editUserInfos"}).otherwise({action:"editMe"})});function MyAccount(b,f,c,d,a){a({editUserInfos:function(g){model.account=new User({id:g.id,edit:{infos:true}});e();b.openView("user-edit","user")},editUser:function(g){model.account=new User({id:g.id,edit:{userbook:true,infos:true}});e();b.openView("user-edit","user");b.openView("userbook-edit","userbook")},editMe:function(g){model.account=new User({id:model.me.userId,edit:{userbook:true,visibility:true}});if(model.me.type==="ENSEIGNANT"){model.account.edit.infos=true;b.openView("user-edit","user")}else{b.openView("user-view","user")}e();b.openView("userbook-edit","userbook")}});function e(){b.me=model.me;model.account.on("change",function(){b.$apply()});model.account.load();b.account=model.account}b.display={};b.viewsContainers={};b.openView=function(g,h){var i="/directory/public/template/";b.viewsContainers[h]=i+g+".html"};b.containsView=function(h,g){var i="/directory/public/template/";return b.viewsContainers[h]===i+g+".html"};b.moods=User.prototype.moods;b.availableMoods=_.reject(b.moods,function(g){return g.id==="default"});b.resetPasswordPath="/auth/reset/password";b.birthDate=function(g){if(g){return c.format(g,"D MMMM YYYY")}return""};b.translate=function(g){return f.translate(g)};b.saveChanges=function(){model.account.saveChanges()};b.openPasswordDialog=function(){ui.showLightbox();b.account.password=""};b.closePassword=function(){ui.hideLightbox()};b.saveInfos=function(){model.account.saveInfos()};b.resetPassword=function(g){http().post(g,{oldPassword:b.account.oldPassword,password:b.account.password,confirmPassword:b.account.password,login:b.account.login,callback:"/userbook/mon-compte"}).done(function(h){if(h.indexOf("html")===-1){d.error("Le formulaire contient des erreurs")}else{b.resetErrors=false;ui.hideLightbox()}b.$apply()})};b.saveUserbookProperty=function(g){model.account.saveUserbookProperty(g)};b.changeVisibility=function(g){if(g.visibility.toLowerCase()==="public"){g.visibility="PRIVE"}else{g.visibility="PUBLIC"}http().get("api/set-visibility",{value:g.visibility,category:g.category})};b.changeInfosVisibility=function(h,g){if(g.toLowerCase()==="public"){b.account.visible[h]="prive"}else{b.account.visible[h]="public"}http().get("api/edit-user-info-visibility",{info:h,state:b.account.visible[h]})};b.resetAvatar=function(){model.account.picture="";model.account.saveChanges()};b.updateAvatar=function(){model.account.uploadAvatar()}};