function User(a){this.updateData(a);this.select=function(){var b=this;http().get("/userbook/api/person?id="+this.id+"&type="+this.type).done(function(c){c.result[0].hobbies=_.map(c.result[0].category,function(d,e){return{category:d,value:c.result[0].values[e]}});c.result[0].relatives=_.map(c.result,function(d){return new User({displayName:d.relatedName,id:d.relatedId,type:d.relatedType})});c.result[0].relatives=_.filter(c.result[0].relatives,function(d){return d.id!==""});b.selected=true;b.updateData(c.result[0]);model.directory.users.setCurrent(b);model.myClass.users.setCurrent(b)})};this.deselect=function(){this.selected=false;model.directory.users.setCurrent(undefined);model.myClass.users.setCurrent(undefined)}}function MyClass(){this.name="";this.collection(User,{sync:function(){var a=this;http().get("/userbook/api/class").done(function(b){a.load(_.map(b.result,function(c){if(!c.mood){c.mood="default"}return c}))})},match:function(b){var a=lang.removeAccents(b).toLowerCase();if(!a){return this.all}return _.filter(this.all,function(d){var c="",e="";if(d.displayName){c=lang.removeAccents(d.displayName).toLowerCase();e=lang.removeAccents(d.displayName.split(" ")[1]+" "+d.displayName.split(" ")[0]).toLowerCase()}return c.indexOf(a)!==-1||e.indexOf(a)!==-1})}})}function Directory(){this.collection(User,{match:function(){return this.all},searchDirectory:function(b){var c=this;var a=lang.removeAccents(b).toLowerCase();this.loading=true;http().get("/userbook/api/search?name="+a).done(function(d){c.loading=false;c.load(_.map(d.result,function(e){if(!e.mood){e.mood="default"}return e}))})}})}model.build=function(){this.makeModels([User,MyClass,Directory]);this.myClass=new MyClass();this.directory=new Directory()};