routes.define(function(a){a.when("/search",{action:"directory"}).when("/myClass",{action:"myClass"}).when("/user-view/:userId",{action:"viewUser"}).when("/:userId",{action:"viewUser"}).otherwise({redirectTo:"/myClass"})});function DirectoryController(b,c,a){b.users=[];b.lang=lang;b.search={text:"",field:"",maxLength:15,clear:function(){this.text="";this.field=""}};b.increaseSearchSize=function(){b.search.maxLength+=15;if(!b.$$phase){b.$apply("search")}};b.viewsContainers={};b.openView=function(e,f){b.search.maxLength=15;var g="/directory/public/template/";b.viewsContainers[f]=g+e+".html"};b.containsView=function(f,e){var g="/directory/public/template/";return b.viewsContainers[f]===g+e+".html"};b.openView("class","page");b.openView("user-infos","details");a({viewUser:function(e){new User({id:e.userId}).select();b.users=c.directory.users;b.openView("profile","page");b.title="profile"},directory:function(){b.users=c.directory.users;b.openView("directory","page");b.viewsContainers.main="empty";b.title="directory"},myClass:function(){b.users=c.myClass.users;c.myClass.sync();b.openView("class","page");b.title="class"}});b.searchDirectory=function(){c.directory.users.all=[];c.directory.users.searchDirectory(b.search.field);b.openView("list-view","main")};b.selectFirstUser=function(){if(c.directory.users.length){b.selectUser(c.directory.users.first())}else{b.selectUser(c.myClass.users.first())}};b.deselectUser=function(){if(c.directory.users.current){c.directory.users.current.deselect()}if(c.myClass.users.current){c.myClass.users.current.deselect()}b.openView("list-view","main")};b.selectUser=function(e){if(!b.$$phase){b.$apply("search")}if(b.containsView("main","user-selected")){ui.scrollToTop()}else{window.scrollTo(0,200)}c.directory.users.deselectAll();c.myClass.users.deselectAll();e.select();b.openView("user-selected","main")};var d={relative:"cyan",teacher:"green",student:"orange"};b.colorFromType=function(e){return d[e.toLowerCase()]};c.on("directory.users.change, myClass.users.change",function(f){if(!b.$$phase){b.$apply("users")}});b.openView("list-view","main")}function ClassAdminController(a,c,b,d){c.classAdmin.sync();a.classAdmin=c.classAdmin;a.users=c.classAdmin.users;a.newUser={};a.viewsContainers={};a.openView=function(e,f){if(f==="lightbox"){ui.showLightbox()}var g="/directory/public/template/";a.viewsContainers[f]=g+e+".html"};a.containsView=function(f,e){var g="/directory/public/template/";return a.viewsContainers[f]===g+e+".html"};c.on("classAdmin.users.change",function(){if(!a.$$phase){a.$apply("users")}});c.on("classAdmin.change",function(){if(!a.$$phase){a.$apply("classAdmin")}});a.shortDate=function(e){return moment(e).format("D/MM/YYYY")};a.display={show:"Student",selectAll:false};a.show=function(e){a.display.show=e};a.switchAll=function(){if(a.display.selectAll){c.classAdmin.users.selectAll()}else{c.classAdmin.users.deselectAll()}};a.saveClassInfos=function(){c.classAdmin.saveClassInfos()};a.importCSV=function(){c.classAdmin.importFile()};a.grabUser=function(e){c.classAdmin.grabUser(e);d.info("Utilisateur ajouté");ui.hideLightbox();a.newUser={}};a.createUser=function(){var e=new User(a.newUser);e.type=a.display.show;c.classAdmin.addUser(e);a.newUser={};$("#lastName").focus();d.info("Utilisateur ajouté")};a.addUser=function(){a.existingMatchs=c.myClass.users.match.call(c.directory.users,a.newUser.firstName+" "+a.newUser.lastName);if(a.existingMatchs.length>0){a.openView("link-user","lightbox");return}a.createUser()};a.blockUsers=function(){c.classAdmin.blockUsers(true)};a.unblockUsers=function(){c.classAdmin.blockUsers(false)};a.resetPasswords=function(){if(!c.me.email){d.error("Veuillez renseigner votre adresse e-mail")}else{d.info("Les nouveaux mots de passe ont été envoyés à votre adresse e-mail");c.classAdmin.resetPasswords()}}};