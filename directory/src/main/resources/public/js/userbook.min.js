function UserBook(a){a.book={};a.currentPerson={}}var replaceAvatars=function(){$(".avatar").each(function(a,b){$("<div></div>").css({"background-image":"url("+$(b).find("img").attr("src")+")"}).addClass("avatar-image").appendTo(b);$(b).find("img").remove()})};var userbook=function(){var c=function(g){var f=[];var e=[];for(obj in g.result){if(g.result[obj].userId!==g.result[obj].id){g.result[obj].mood="default";g.result[obj].photo=""}if(g.result[obj].type==="Student"){f.push(g.result[obj])}else{if(g.result[obj].type==="Teacher"){e.push(g.result[obj])}}}return{students:f,anyStudent:f.length>0,teachers:e,anyTeacher:e.length>0}};var a=function(h){var g=[];var e=[];var f=[];for(obj in h.result){if(h.result[obj].photo===""&&h.result[obj].mood===""&&h.result[obj].userId===""){h.result[obj].mood="default"}if(h.result[obj].type==="Student"){g.push(h.result[obj])}else{if(h.result[obj].type==="Teacher"){e.push(h.result[obj])}else{f.push(h.result[obj])}}}return{students:g,anyStudent:g.length>0,teachers:e,anyTeacher:e.length>0,parents:f,anyParent:f.length>0}};var b=function(f){var e=f.result[0];e.hobbies=[];f.result[0].category.forEach(function(h,g){e.hobbies.push({category:h,values:f.result[0].values[g]})});e.relations=[];_.values(f.result).forEach(function(g){e.relations.push(_.pick(g,"relatedId","relatedName","relatedType"))});return e};var d=Object.create(oneApp);d.scope=".annuaire";d.define({template:{searchResults:'				{{#anyTeacher}}					<h1>{{#i18n}}userBook.teachers{{/i18n}}</h1>				{{/anyTeacher}}				{{#teachers}}				<div class="cell four text-container" >					<article class="box row person text-container" id={{id}}>							<div class="four cell avatar"><img src="document/{{photo}}?userbook-dimg=public%2Fimg%2Fno-avatar.jpg&thumbnail=82x82" alt="user" /></div>							<div class="six cell" style="height: 100%">								<div class="row">									<h4 href="api/person?id={{id}}&type={{type}}" call="person">{{displayName}}</h4>								</div>								<div class="row bottom-locked">									<span class="actions">									<i role="send-mail"></i>									<i role="view-book"></i>									<i role="view-folder"></i>								</span>								</div>							</div>							<div class="two cell"><i role="{{mood}}-panda" class="liquid"></i></div>					</article>				</div>				{{/teachers}}				<div class="clear"></div>				{{#anyParent}}					<h1>{{#i18n}}userBook.parents{{/i18n}}</h1>				{{/anyParent}}				{{#parents}}				<div class="cell four text-container" >					<article class="box row person text-container" id={{id}}>							<div class="four cell avatar"><img src="document/{{photo}}?userbook-dimg=public%2Fimg%2Fno-avatar.jpg&thumbnail=82x82" alt="user" /></div>							<div class="six cell" style="height: 100%">								<div class="row">									<h4 href="api/person?id={{id}}&type={{type}}" call="person">{{displayName}}</h4>								</div>								<div class="row bottom-locked">									<span class="actions">									<i role="send-mail"></i>									<i role="view-book"></i>									<i role="view-folder"></i>								</span>								</div>							</div>							<div class="two cell"><i role="{{mood}}-panda" class="liquid"></i></div>					</article>				</div>				{{/parents}}				<div class="clear"></div>				{{#anyStudent}}					<h1>{{#i18n}}userBook.students{{/i18n}}</h1>				{{/anyStudent}}				{{#students}}				<div class="cell four text-container" >					<article class="box row person text-container" id={{id}}>							<div class="four cell avatar"><img src="document/{{photo}}?userbook-dimg=public%2Fimg%2Fno-avatar.jpg&thumbnail=82x82" alt="user" /></div>							<div class="six cell" style="height: 100%">								<div class="row">									<h4 href="api/person?id={{id}}&type={{type}}" call="person">{{displayName}}</h4>								</div>								<div class="row bottom-locked">									<span class="actions">									<i role="send-mail"></i>									<i role="view-book"></i>									<i role="view-folder"></i>								</span>								</div>							</div>							<div class="two cell"><i role="{{mood}}-panda" class="liquid"></i></div>					</article>				</div>				{{/students}}',personne:'				<div class="row fixed-block height-four">					<div class="text-container fixed cell four">						<div class="avatar twelve fluid cell">							<img src="document/{{photo}}?userbook-dimg=public%2Fimg%2Fno-avatar.jpg&thumbnail=290x290" alt="user" />						</div>					</div>					<div class="fixed cell eight text-container right-magnet">						<article class="cell twelve text-container fluid">							<h2>{{displayName}}</h2>							{{#email}}							<div class="row">								<div class="four cell">{{#i18n}}userBook.profile.email{{/i18n}}</div>								<em class="eight cell">{{email}}</em>							</div>							{{/email}}							{{#address}}							<div class="row">								<div class="four cell">{{#i18n}}userBook.profile.address{{/i18n}}</div>								<em class="eight cell">{{address}}</em>							</div>							{{/address}}							{{#tel}}                            <div class="row">                                <div class="four cell">{{#i18n}}userBook.profile.telephone{{/i18n}}</div>                                <em class="eight cell">{{tel}}</em>                            </div>                            {{/tel}}                            {{#birthdate}}                            <div class="row">                                <div class="four cell">{{#i18n}}userBook.profile.birthdate{{/i18n}}</div>                                <em class="eight cell">{{birthdate}}</em>                            </div>                            {{/birthdate}}							<div class="row">								<div class="four cell">{{#i18n}}userBook.profile.motto{{/i18n}}</div>								<em class="eight cell">{{motto}}</em>							</div>							<div class="row mini-box">								<div class="two cell avatar"><i role="{{mood}}-panda" class="liquid"></i></div>								<em class="ten cell text-container mood">{{#i18n}}userBook.mood.{{mood}}{{/i18n}}</em>							</div>						</article>					</div>				</div>				<div class="row text-container">					<article id="actions" class="row text-container">					<div class="row">						<a><h3><i role="send-mail" class="text-flow"></i> {{#i18n}}userBook.class.write-message{{/i18n}}</h3></a>					</div>					<div class="row">						<a><h3><i role="view-book" class="text-flow"></i> {{#i18n}}userBook.class.edit-notebook{{/i18n}}</h3></a>					</div>					<div class="row">						<a><h3><i role="view-folder" class="text-flow"></i> {{#i18n}}userBook.class.see-portfolio{{/i18n}}</h3></a>					</div>					<div class="clear"></div>				</article>				</div>				<h1 class="clear mini-box">{{#i18n}}userBook.profile.family{{/i18n}}</h1>				<article class="text-container">					{{#relations}}						<p>							<a href="api/person?id={{relatedId}}&type={{relatedType}}" call="person">{{relatedName}}</a>						</p>					{{/relations}}				</article>				<h1>{{#i18n}}userBook.interests{{/i18n}}</h1>				<article class="text-container">					{{#hobbies}}					<div class="row line">						<div class="three cell mini-block-container">{{#i18n}}userBook.hobby.{{category}}{{/i18n}}</div>						<div class="eight cell mini-block-container user-content"><em>{{values}}</em></div>						<div class="one cell"></div>						<div class="clear"></div>					</div>					{{/hobbies}}					<div class="clear"></div>				</article>				{{#health}}				<h1>{{#i18n}}userBook.profile.health{{/i18n}}</h1>				<article class="text-container user-content">{{health}}</article>				{{/health}}	'},action:{search:function(f){var e=f.target.form.action+"?"+$("#search-form").serialize();One.get(e).done(function(g){$("#people").removeClass("four").addClass("twelve");$("#person").html("");if(g.result[0]===undefined){d.notify.info("Aucun résultat");$("#people").html("");$("#person").html("")}else{$("#people").html(d.template.render("searchResults",a(g)))}replaceAvatars()}).error(function(g){d.notify.error(g.status)})},showList:function(){this.refreshClassList()},refresh:function(){window.location.reload()},showPerson:function(e){$("#people .text-container.four").addClass("twelve").removeClass("four");$("#people").addClass("four").removeClass("twelve");$("#people .selected").removeClass("selected");if(e.result[0].type!=="Relative"){$("#"+e.result[0].id).addClass("selected")}$("#person").html(d.template.render("personne",b(e)));$("i[role=show-icons]").removeClass("selected");$("i[role=show-details]").addClass("selected")},showFirstPerson:function(){var e=this;One.get($(".person").first().find("h4").attr("href")).done(function(f){e.showPerson(f)})},person:function(f){var e=this;One.get(f.url).done(function(g){e.showPerson(g)})},refreshClassList:function(){if(location.search.substring(1,8)==="myClass"){userbook.action.searchClass("api/class")}},searchClass:function(e){One.get(e).done(function(f){$("#people .text-container.twelve").addClass("four").removeClass("twelve");$("#people").removeClass("four").addClass("twelve");$("#people .selected").removeClass("selected");$("#person").html("");if(f.result[0]===undefined){d.notify.info("Aucun résultat");$("#people").html("");$("#person").html("")}else{$("#people").html(d.template.render("searchResults",c(f)))}replaceAvatars()})}}});return d}();$(document).ready(function(){userbook.init();userbook.action.refreshClassList();if(location.href.indexOf("#",0)!==-1){setTimeout(function(){var a=location.href.split("#")[1];$("#people").remove();$("#person").removeClass("eight").addClass("twelve");$(".annuaire").first().remove();$(".search").remove();userbook.action.person({url:"api/person?id="+location.href.split("#")[1]+"&type="+location.href.split("#")[2]})},500)}});