<!--
    |||||||||||||||||||||||
    |||  STRUCTURE OPS  |||
    |||||||||||||||||||||||
-->

<!-- Structure selection menu -->
<div>
    <div ng-include="'structure-tree'"></div>
    <div class="three" style="position: relative;">
        <div class="vertical_buttons_container" style="right: -36px; top: 17px;">
            <!-- Creation button -->
            <button ng-click="setShowWhat('showStructureCreation'); initStructure()"
                    ng-if="isCentralAdmin()"
                    tooltip="directory.tooltip.createStructure"
                    class="directory-list-glyph-button plus-icon">
            </button>
        </div>
    </div>
</div>

<article class="side-tabs-content nine cell" ng-if="structure || createdStructure">

    <!-- Structure details -->
    <div ng-if="structure && showWhat !== 'showStructureCreation'">
        <div class="row"><h1 style="margin-bottom: 0; text-align:center;">[[structure.name]]</h1></div>
        <hr class="separator cell">
        <div style="text-align:center">
            <button ng-click="structure.update()">[[lang.translate("directory.save")]]</button>
        </div>
        <hr class="separator cell">
        <div class="twelve cell"><strong class="four cell">[[lang.translate("directory.userId")]]</strong> [[structure.id]]</div>
        <div class="twelve cell">
            <strong class="four cell padding-top-5">[[lang.translate("directory.name")]]</strong>
            <input class="eight cell" type="text" ng-model="structure.name"/>
        </div>
        <div class="twelve cell" ng-if="structure.parents">
            <strong class="four cell padding-top-5">[[lang.translate("directory.structure.parents")]]</strong>
            <nav class="eight cell">
                <ul class="angle-list small" style="margin: 0">
                    <li ng-repeat="parent in structures.all | filter : filterOnlyParentStructures | orderBy: 'name'">[[parent.name]] <button class="right-magnet close" ng-click="structure.detachParent(parent, refreshScope)"></button></li>
                </ul>
            </nav>
        </div>
        <!-- Export -->
        <hr class="separator cell">
        <h3 class="twelve cell" style="margin-top: 0;">[[lang.translate("directory.exportStructure")]]</h3>
        <div class="row" ng-init="exportData.params.filterActive = ''">
            <select class="five cell row-item" ng-model="exportData.params.profile" ng-change="deleteIfEmpty(exportData.params, 'profile')">
                <option value="">[[lang.translate("directory.allProfiles")]]</option>
                <option value="Teacher">[[lang.translate("directory.Teacher")]]</option>
                <option value="Personnel">[[lang.translate("directory.Personnel")]]</option>
                <option value="Relative">[[lang.translate("directory.Relative")]]</option>
                <option value="Student">[[lang.translate("directory.Student")]]</option>
                <option value="Guest">[[lang.translate("directory.Guest")]]</option>
            </select>
            <select class="five cell" ng-model="exportData.params.filterActive">
                <option value="">[[lang.translate("directory.ignoreActivation")]]</option>
                <option value="active">[[lang.translate("directory.onlyActivatedUsers")]]</option>
                <option value="inactive">[[lang.translate("directory.onlyInactiveUsers")]]</option>
            </select>
        </div>
        <button class="three cell margin-top-5" ng-click="exportItem(structure, 'structureId')" style="margin-left: 0%; font-size: 12; padding: 2;">[[lang.translate("directory.export")]]</button>
        <!-- Import CSV -->
        <hr class="separator cell">
        <h3 class="twelve cell" style="margin-top: 0;">[[lang.translate("directory.importCSV")]]</h3>
        <div class="row">
            <select class="five cell row-item" ng-model="importCSVData.profile" ng-change="deleteIfEmpty(importCSVData, 'profile')">
                <option value="">[[lang.translate("directory.allProfiles")]]</option>
                <option value="Teacher">[[lang.translate("directory.Teacher")]]</option>
                <option value="Personnel">[[lang.translate("directory.Personnel")]]</option>
                <option value="Relative">[[lang.translate("directory.Relative")]]</option>
                <option value="Student">[[lang.translate("directory.Student")]]</option>
                <option value="Guest">[[lang.translate("directory.Guest")]]</option>
            </select>
            <input class="five cell" type="file" files-input-change ng-model="importCSVData.csv" />
        </div>
        <button class="three cell margin-top-5" ng-click="importCSV(structure)" style="margin-left: 0%; font-size: 12; padding: 2;">[[lang.translate("directory.import")]]</button>
        <!-- Structure grouping -->
        <hr class="separator cell" ng-if="isCentralAdmin()">
        <div class="twelve cell" ng-if="isCentralAdmin()">
            <h3><i18n>directory.admin.attachChildStructures</i18n></h3>
            <nav class="vertical search-container-left three cell" style="height: 380px">
                <input type="text" placeholder="[[lang.translate('directory.search')]]" ng-model="filterStructures"/>
                <ul style="height: 320px; padding-top: 10; border-bottom: none; margin-bottom: 10px">
                    <li ng-repeat="potentialChild in structures.all | filter: filterExcludeCurrentStructure(filterStructures) | filter: filterExcludeDoubles(structure.children) | orderBy: 'name'"
                        ng-click="potentialChild.attachParent(structure, refreshScope)"
                        style="padding-left: 0">
                        <span>[[potentialChild.name]]</span>
                    </li>
                </ul>
            </nav>
            <div class="eight cell">
                <h5 style="text-align: center">[[lang.translate("directory.structure.children")]]</h5>
                <ul class="angle-list small" style="padding-left: 20px">
                    <li ng-repeat="child in structures.all | filter: filterOnlyChildStructures | orderBy: 'name'">
                        [[child.name]]
                        <button class="close right-magnet" ng-click="child.detachParent(structure, refreshScope)"></button>
                    </li>
                </ul>
            </div>
        </div>
        <!-- Set quota -->
        <hr class="separator cell">
        <h3 class="twelve cell" style="margin-top: 0;">[[lang.translate("directory.quota")]]</h3>
        <div class="twelve cell">
            <select class="three cell" ng-model="quotaProfile" ng-init="quotaProfile = 'Teacher'" style="margin-right: 10px;">
                <option value="Teacher">[[lang.translate("directory.Teacher")]]</option>
                <option value="Personnel">[[lang.translate("directory.Personnel")]]</option>
                <option value="Relative">[[lang.translate("directory.Relative")]]</option>
                <option value="Student">[[lang.translate("directory.Student")]]</option>
                <option value="Guest">[[lang.translate("directory.Guest")]]</option>
            </select>
            <select class="three cell" ng-model="quotaUnit" ng-init="quotaUnit = DEFAULT_QUOTA_UNIT" style="margin-right: 10px">
                <option value="1">[[lang.translate("directory.byte")]]</option>
                <option value="1024">[[lang.translate("directory.kilobyte")]]</option>
                <option value="1048576">[[lang.translate("directory.megabyte")]]</option>
                <option value="1073741824">[[lang.translate("directory.gigabyte")]]</option>
                <option value="[[1073741824 * 1024]]">[[lang.translate("directory.terabyte")]]</option>
            </select>
            <input class="three cell" type="number" name="size" ng-model="quotaSize" ng-init="quotaSize = 0"
                   style="height: 25; border-radius: 5px; background: #fff; border: none; padding-left: 5px; font-family: Lato"/>
            <button class="small two right-magnet"
                    style="margin: 0; font-size: 12"
                    ng-click="saveStructureQuota(structure, quotaSize*quotaUnit, quotaProfile)"
                    ng-disabled="!quotaProfile || (quotaSize <= 0)">
                    [[lang.translate("directory.save")]]
            </button>
        </div>

    </div>

    <!-- Structure creation -->
    <div ng-if="showWhat === 'showStructureCreation'">
        <div class="row"><h1 style="margin-bottom: 0; text-align:center;">[[createdStructure.name ? createdStructure.name : lang.translate("directory.structure")]]</h1></div>
        <hr class="separator">
        <div style="text-align:center">
            <button ng-click="createdStructure.create(refreshStructures)">[[lang.translate("directory.admin.create")]]</button>
        </div>
        <hr class="separator">
        <div class="twelve cell">
            <strong class="four cell padding-top-5">[[lang.translate("directory.name")]]</strong>
            <input class="eight cell" type="text" ng-model="createdStructure.name"/>
        </div>
    </div>

</article>
