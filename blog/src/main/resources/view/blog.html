<!DOCTYPE html>
<html>
	<head>
		<title>{{#i18n}}blog.title{{/i18n}}</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<script src="{{#infra}}js/one-loader.js{{/infra}}" type="text/javascript" id="context"></script>
		<script src="{{#static}}js/model.js{{/static}}" type="text/javascript"></script>
		<script src="{{#static}}js/controller.js{{/static}}" type="text/javascript"></script>
	</head>
	<body data-ng-controller="Blog">
	<portal>


	<div class="row">
		<div class="four cell">
			<h1><a data-reload><i role="blog"></i>{{#i18n}}blog.title{{/i18n}}</a></h1>
		</div>
		<div class="eight cell">
			<nav class="contextual-buttons row" ng-if="currentBlog._id">
				<div class="action-buttons">
					<button data-ng-click="showCreatePost()" data-ng-disabled="isEditing()" data-ng-if="isVisible()">
						<i role="add"></i>{{#i18n}}blog.create.post{{/i18n}}
					</button>
				</div>
			</nav>
		</div>
	</div>
	<div class="row">
		<div class="four cell">
			<nav class="vertical">
				<div data-ng-repeat="blog in blogs">
					<article data-ng-class="{'fixed-block':true, 'cell':true,
							 'height-four':true, 'row':true, 'clip': true, 'lower-line': $index !== 0,
							 'selected':isSelected(blog._id)}">
						<div class="four cell fixed">
							<div class="fluid twelve cell v-center-container">
								<p class="v-center"><img ng-src="[[blogThumbnail(blog)]]" /></p>
							</div>
						</div>
						<div class="eight cell fixed right-magnet text-container">
							<div class="row">
								<h3 data-ng-click="displayBlog(blog)">[[blog.title]]</h3>
							</div>
							<div class="row">
								<a ng-href="/userbook/annuaire#[[blog.author.userId]]"><h4>{{#i18n}}blog.by{{/i18n}} [[blog.author.username]]</h4></a>
							</div>
						</div>
					</article>
					<a data-ng-click="showEditBlog(blog)" ng-if="blog.myRights.blog.edit">{{#i18n}}blog.edit.title{{/i18n}}</a>
				</div>
				<h5><a data-ng-click="showCreateBlog()" ng-if="me.myRights.blog.post">{{#i18n}}blog.create.blog{{/i18n}}</a></h5>
			</nav>
	</div>
	<div class="eight cell horizontal-spacing">
			<h3 data-ng-if="isCurrentView('createBlog')">{{#i18n}}blog.create.title{{/i18n}}</h3>
			<h3 data-ng-if="isCurrentView('editBlog')">{{#i18n}}blog.edit.title{{/i18n}}</h3>
			<article class="text-container row" ng-if="blogs.length === 0 && currentView === ''">
				{{#i18n}}noblog{{/i18n}}
			</article>
			<article class="row" ng-if="blogs.length > 0 || currentView !== ''">
				<section data-ng-include="currentView.path" class="row text-container"></section>
				<section data-ng-repeat="post in currentBlog.drafts | limitTo:nbResults('drafts')"
						 ng-class="{row: true, 'text-container': true, line: true, 'greyed-out': post.state !== 'PUBLISHED' }">
					<div ng-include="postTemplate(post).path"></div>
				</section>
				<section data-ng-repeat="post in currentBlog.submitted | limitTo:nbResults('submitted')"
						 ng-class="{row: true, 'text-container': true, line: true, 'greyed-out': post.state !== 'PUBLISHED' }">
					<div ng-include="postTemplate(post).path"></div>
				</section>
				<section data-ng-repeat="post in currentBlog.posts | limitTo:nbResults('posts')"
						 class="row text-container line">
					<div ng-include="postTemplate(post).path"></div>
				</section>
				<h3 ng-if="maxResults < currentBlog.posts.length + currentBlog.submitted.length + currentBlog.drafts.length" class="text-container">
					<a ng-click="addResults()" class="right-magnet">[[translate('seemore')]]</a>
					<div class="clear"></div>
				</h3>
			</article>
		</div>
		<div class="clear"></div>
		</div>
	</portal>
	<section class="lightbox-backdrop"></section>
	<section class="lightbox-window six cell">
		<div class="twelve cell">
				<section ng-include="lightboxPath">
				</section>
		</div>
		<div class="close-lightbox">
			<i role="close-2x"></i>
		</div>
		<div class="clear"></div>
	</section>
	</body>
</html>
