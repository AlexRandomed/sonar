<!DOCTYPE html>
<html>
	<head>
		<title>{{#i18n}}workspace.title{{/i18n}}</title>
		<meta charset="utf-8" />
		<script src="{{#infra}}js/one-loader.js{{/infra}}" type="text/javascript" id="context"></script>
		<script src="{{#static}}js/model.js{{/static}}" type="text/javascript"></script>
		<script src="{{#static}}js/controller.js{{/static}}" type="text/javascript"></script>

		<script type="text/ng-template" id="folder-content">
			<a data-ng-class="{ selected: openedFolder.folder === value }" data-ng-click="openFolder(value, key)">[[translate(key)]]</a>
			<ul data-ng-class="{ selected: containsCurrentFolder(value), closed: !containsCurrentFolder(value) }" ng-if="containsCurrentFolder(value)">
				<li data-ng-repeat="(key, value) in value"
					data-ng-include="'folder-content'"
				></li>
			</ul>
		</script>
		<script type="text/ng-template" id="folder-management">
			<input type="radio" name="folder" ng-if="editMode === 'single'" ng-model="selectedFolder.name" ng-value="key" ng-change="setFolder(key, value)" />
			<input type="checkbox" ng-if="editMode === 'multiple'" ng-checked="isTargetFolder(key, value)" ng-value="key" ng-click="switchTargetFolder(key, value)" />
			<span>
				<a ng-click="openEditView(value)"><strong>+</strong></a>[[translate(key || 'documents')]]
			</span>
			<ul class="row">
				<li class="row" ng-if="isEditViewOpened(value)">
					<input type="radio" name="folder" ng-click="startEditing(value)" ng-if="editMode === 'single'" />
					<input type="checkbox" ng-click="startEditing(value)" ng-if="editMode === 'multiple'" />
					<em ng-if="!editStarted(value)">Nouveau dossier</em>
					<em class="editable" ng-if="editStarted(value)">
						<input type="text" class="inline-editing" ng-model="temp" complete-change="addFolder(value, temp)" />
					</em>
				</li>
				<li data-ng-repeat="(key, value) in value"
					data-ng-include="'folder-management'"
				></li>
			</ul>
		</script>
	</head>
	<body data-ng-controller="Workspace">
	<portal>


		<div class="row">
			<section class="four cell">
				<h1><a data-reload><i role="storage"></i>{{#i18n}}workspace.header{{/i18n}}</a></h1>
				<nav class="vertical" ng-init="value=folders">
					<ul data-ng-include="'folder-content'"></ul>
				</nav>
			</section>
			<section class="eight cell">
				<nav class="contextual-buttons row">
					<div class="action-buttons">
						<div class="cell" ng-repeat="button in currentTree.buttons"><button
								ng-click="button.action(button.url)"
								ng-if="button.allow()">
							<i role="add" ng-if="button.icon"></i> [[translate(button.text)]]
						</button></div>
					</div>
					<div class="display-buttons">
						<i role="show-list"
						   ng-class="{ selected: currentViews.documents === views.documents.list }"
						   ng-click="switchView('documents', 'list')"></i>
						<i role="show-icons"
							ng-class="{ selected: currentViews.documents === views.documents.icons }"
							ng-click="switchView('documents', 'icons')"></i>
					</div>
				</nav>

				<article data-ng-include="currentViews.documents" class="row"></article>
			</section>
		</div>

		<div class="clear"></div>
	</portal>
	<section class="lightbox-window five cell" loading-panel="file-upload">
		<div class="twelve cell" ng-include="currentViews.lightbox"></div>
		<div class="close-lightbox">
			<i role="close-2x"></i>
		</div>
		<div class="clear"></div>
	</section>
	<section ng-class="{'toggle-bottom': true, hide: selectedDocuments().length === 0 }">
		<div class="toggle block-container">
			<div class="row">
				<div class="cell" ng-repeat="button in currentTree.contextualButtons">
					<button
						ng-click="button.action(button.url)"
						ng-if="button.allow()">
					[[translate(button.text)]]
					</button>
				</div>
				<button ng-click="openCommentView(selectedDocuments()[0])"
						ng-if="selectedDocuments()[0].myRights.comment.post"
						translate key="workspace.document.comment"
						ng-class="{ cell: true, hide: selectedDocuments().length > 1 }">
				</button>
				<button ng-click="openShareView(selectedDocuments()[0])"
						translate key="workspace.share"
						ng-if="selectedDocuments()[0].myRights.document.share && workflowRight('share')"
						ng-class="{ cell: true, hide: selectedDocuments().length > 1 }">
				</button>
				<span class="contextual-link"
					  ng-if="selectedDocuments().length === 1 && selectedDocuments()[0].comments.length > 0">
					<a ng-if="selectedDocuments()[0] !== documentComment" data-ng-click="toggleComments(selectedDocuments()[0])">
						[[translate('workspace.document.comment.show')]] ([[selectedDocuments()[0].comments.length]])
					</a>
					<a ng-if="selectedDocuments()[0] === documentComment" data-ng-click="toggleComments(selectedDocuments()[0])">
						[[translate('workspace.document.comment.hide')]]
					</a>
				</span>
			</div>
			</div>

		</div>
	</section>
	<section class="lightbox-backdrop"></section>
	</body>
</html>
