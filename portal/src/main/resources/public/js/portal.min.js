var navigation=(function(){var d=[];var c="/workspace";var a=function(){var e=$("#theme").attr("href");var f={name:"set-style",data:e};return f};var b=function(){var e={name:"set-history",data:history};return e};return{redirect:function(f,e){if(!e){d.push(f)}$("#applications").attr("src",f);$("#applications").unbind("load");$("#applications").on("load",function(g){setTimeout(function(){messenger.sendMessage("#applications",a());history.pushState({},null,"#app="+f)},100)})},applyHash:function(){var f=window.location.href.split("#app=");var e=$(".logo").attr("data-link");if(f.length>1){e=f[1].split("&")[0]}navigation.redirect(e)},back:function(){d.length=d.length-1;navigation.redirect(d.length-1)}}}());var messenger=(function(){var b=function(e,d){var c=window.location.href;if($(e).attr("src").indexOf("http")!==-1){c=$(e).attr("src")}$(e)[0].contentWindow.postMessage(JSON.stringify(d),c)};var a={redirect:function(c){navigation.redirect(c.data)},resize:function(c){$("#applications").height(c.data.height)},"where-lightbox":function(d){if($("#lightbox-marker").length>0){var c=$("#lightbox-marker").offset().top;var e=$("#applications").offset().top;b("#applications",{name:"lightbox-position",data:{posY:c-e,viewportHeight:$(window).height()}})}},lightbox:function(c){$("header").addClass("lightbox-header");$("body").addClass("lightbox-body");$("section.main").addClass("lightbox-main");$("<div></div>").attr("id","lightbox-marker").css({position:"fixed",top:"0px"}).appendTo("body");var d=this.closeLightbox;$("body").one("click.lightbox",function(){d();$("iframe").attr("src",$("iframe").attr("src"))})},"close-lightbox":function(c){$("header").removeClass("lightbox-header");$("body").removeClass("lightbox-body");$("section.main").removeClass("lightbox-main");$("body").unbind("click.lightbox")},notify:function(c){humane.spawn({addnCls:"humane-original-"+c.data.type})(lang.translate(c.data.message))},"redirect-parent":function(c){window.location.href=c.data},"update-avatar":function(){ui.updateAvatar()}};if(window.addEventListener){window.addEventListener("message",function(d){var c=JSON.parse(d.data);a[c.name](c)})}return{sendMessage:b}}());function Navigation(a){navigation.applyHash();a.redirect=function(b){navigation.redirect(b)}}function Account(a){a.pictureVersion=0;a.refreshAvatar=function(){http().get("/userbook/api/person").done(function(b){a.avatar=b.result["0"].photo;a.pictureVersion=a.pictureVersion+1;a.$apply()})};a.refreshAvatar()}window.addEventListener("hashchange",function(){navigation.applyHash()});window.addEventListener("load",function(){$(".remove-fout").removeClass("remove-fout")});